<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>事故報告書</title>
    <link rel="stylesheet" href="accident-report.css">
</head>
<body>

<div class="form-container">
    <h1 class="form-title">事故報告書</h1>

    <form id="accidentForm" class="grid-form">

        <!-- 事故報告書フォームだと分かるように識別用 -->
        <input type="hidden" name="formType" value="accidentReport">

        <!-- 発生日付 -->
        <div class="grid-cell label-cell" style="grid-column: 3 / span 4; grid-row: 2;">
            発生日付
        </div>
        <div class="grid-cell input-cell" style="grid-column: 7 / span 14; grid-row: 2;">
            <input type="number" name="C5" placeholder="2025" style="width:5em;"> 年
            <input type="number" name="E5" placeholder="4"    style="width:4em;"> 月
            <input type="number" name="G5" placeholder="23"   style="width:4em;"> 日
        </div>

        <!-- 報告者氏名 / 天候 -->
        <div class="grid-cell label-cell" style="grid-column: 1 / span 4; grid-row: 3;">報告者氏名</div>
        <div class="grid-cell input-cell" style="grid-column: 5 / span 7; grid-row: 3;">
            <input type="text" name="B6" placeholder="例：文泉 花子">
        </div>

        <div class="grid-cell label-cell" style="grid-column: 12 / span 4; grid-row: 3;">天候</div>
        <div class="grid-cell input-cell" style="grid-column: 16 / span 8; grid-row: 3;">
            <input type="text" name="D6" placeholder="例：晴れ">
        </div>

        <!-- 車両番号 / 発生場所 -->
        <div class="grid-cell label-cell" style="grid-column: 1 / span 4; grid-row: 4;">車両番号</div>
        <div class="grid-cell input-cell" style="grid-column: 5 / span 7; grid-row: 4;">
            <input type="text" name="B7" placeholder="例：品川300 あ 12-34">
        </div>

        <div class="grid-cell label-cell" style="grid-column: 12 / span 4; grid-row: 4;">発生場所</div>
        <div class="grid-cell input-cell" style="grid-column: 16 / span 8; grid-row: 4;">
            <input type="text" name="D7" placeholder="例：○○県○○市○○交差点付近">
        </div>

        <!-- 事故相手 -->
        <div class="grid-cell section-title section-danger" style="grid-column: 1 / -1; grid-row: 5;">
            事故相手（存在した場合）
        </div>

        <div class="grid-cell label-cell danger-text" style="grid-column: 1 / span 4; grid-row: 6;">氏名</div>
        <div class="grid-cell input-cell" style="grid-column: 5 / span 7; grid-row: 6;">
            <input type="text" name="B9" placeholder="例：山田 太郎">
        </div>

        <div class="grid-cell label-cell danger-text" style="grid-column: 12 / span 4; grid-row: 6;">住所</div>
        <div class="grid-cell input-cell" style="grid-column: 16 / span 8; grid-row: 6;">
            <input type="text" name="D9" placeholder="例：東京都渋谷区○○1-2-3">
        </div>

        <div class="grid-cell label-cell danger-text" style="grid-column: 1 / span 4; grid-row: 7;">電話番号</div>
        <div class="grid-cell input-cell" style="grid-column: 5 / span 7; grid-row: 7;">
            <input type="tel" name="B10" placeholder="例：080-1234-5678">
        </div>

        <div class="grid-cell label-cell danger-text" style="grid-column: 12 / span 4; grid-row: 7;">勤務先</div>
        <div class="grid-cell input-cell" style="grid-column: 16 / span 8; grid-row: 7;">
            <input type="text" name="D10" placeholder="例：株式会社○○">
        </div>

        <!-- 事故の内容 -->
        <div class="grid-cell section-title" style="grid-column: 1 / -1; grid-row: 8;">事故の内容</div>
        <div class="grid-cell input-cell" style="grid-column: 1 / -1; grid-row: 9 / span 3;">
            <textarea name="A12" rows="4" placeholder="例：交差点を直進中、左側から出てきた車と接触した…"></textarea>
        </div>

        <!-- 発生原因 -->
        <div class="grid-cell section-title" style="grid-column: 1 / -1; grid-row: 12;">発生原因</div>
        <div class="grid-cell input-cell" style="grid-column: 1 / -1; grid-row: 13 / span 3;">
            <textarea name="A14" rows="4" placeholder="例：安全確認不足、視界不良、速度超過など"></textarea>
        </div>

        <!-- 被害状況 -->
        <div class="grid-cell section-title" style="grid-column: 1 / -1; grid-row: 16;">被害状況</div>
        <div class="grid-cell input-cell" style="grid-column: 1 / -1; grid-row: 17 / span 3;">
            <textarea name="A16" rows="4" placeholder="例：自車左前部のバンパー損傷、人的被害なし など"></textarea>
        </div>

        <!-- 対応策 -->
        <div class="grid-cell section-title" style="grid-column: 1 / -1; grid-row: 20;">対応策</div>
        <div class="grid-cell input-cell" style="grid-column: 1 / -1; grid-row: 21 / span 3;">
            <textarea name="A18" rows="4" placeholder="例：負傷者確認、警察・会社への連絡、現場写真撮影など"></textarea>
        </div>

        <!-- 再発防止策 -->
        <div class="grid-cell section-title" style="grid-column: 1 / -1; grid-row: 24;">再発防止策</div>
        <div class="grid-cell input-cell" style="grid-column: 1 / -1; grid-row: 25 / span 3;">
            <textarea name="A20" rows="4" placeholder="例：左右確認の徹底、速度抑制、ヒヤリハット共有など"></textarea>
        </div>

        <!-- 反省 -->
        <div class="grid-cell section-title" style="grid-column: 1 / -1; grid-row: 28;">反省</div>
        <div class="grid-cell input-cell" style="grid-column: 1 / -1; grid-row: 29 / span 3;">
            <textarea name="A22" rows="4" placeholder="例：気の緩みがあったため、確認を怠った など"></textarea>
        </div>

        <!-- 備考欄 -->
        <div class="grid-cell section-title" style="grid-column: 1 / -1; grid-row: 32;">備考欄</div>
        <div class="grid-cell input-cell" style="grid-column: 1 / -1; grid-row: 33 / span 3;">
            <textarea name="A24" rows="4" placeholder="例：保険会社からの指示事項、会社への連絡事項など"></textarea>
        </div>

        <!-- 送信ボタン -->
        <div class="grid-cell" style="grid-column: 1 / -1; grid-row: 37; text-align:center;">
            <button type="submit" class="submit-button">報告書を作成してダウンロード</button>
        </div>

    </form>
</div>

<!-- GASへ送信するJS -->
<script>
  // ★ここをあなたのGAS WebアプリURLに変える
  const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/【あなたのデプロイURL】/exec';

  document.getElementById('accidentForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);
    const data = {};

    formData.forEach((value, key) => {
      data[key] = value;
    });

    try {
      const res = await fetch(GAS_WEB_APP_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
      });

      const json = await res.json();

      if (json.status === 'ok') {
        alert('送信完了\nPDF: ' + json.pdfUrl + '\nExcel: ' + json.xlsxUrl);
      } else {
        // ★ここだけ前より詳細に：GAS側でthrowしたエラーメッセージを表示
        alert('送信に失敗しました:\n' + (json.message || '（理由不明）'));
        console.error(json);
      }
    } catch (err) {
      alert('通信エラー:\n' + err);
      console.error(err);
    }
  });
</script>

</body>
</html>
